<!doctype html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/style.css?v=3.1">
    <link rel="icon" href="/images/webp/meipulseras.webp" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.slim.min.js" integrity="sha256-kmHvs0B+OpCW5GVHUNjv9rOmY0IvSIRcf7zGUDTDQM8=" crossorigin="anonymous"></script>
    <title>Register</title>
</head>
<body onload="alerta()">
    <div class="nav" id="nav">
        <ul class="navbar" id="navbar">
            <ul class="navbar" id="navbar">
                <li class="links"><a class="logosredes" href="/"> 
                    <img class="wsplogo" src="/images/webp/home.webp" alt="con_logo"></a></li>
        </ul>
    </div>
    <div class="relleno2"></div>
    <div class="formu">
        <form action="/signup" method="post" id="registro">
            <div class="inputforms">
                <div class="lblinput">
                    <div class="inputlbl">
                        <label class="lang lblform" key="F1" for="user">USUARIO:</label>
                        <input class="forminput" type="text" id="user" name="user" minlength="6" maxlength="12" required><br />
                    </div>
                    <br />
                    <div class="inputlbl">
                        <label class="lang lblform" key="F1" for="fullname">NOMBRE COMPLETO:</label>
                        <input class="forminput" type="text" id="fullname" minlength="10" name="fullname" required><br />
                    </div>
                    <br />
                    <div class="inputlbl">
                        <label class="lang lblform" key="F1" for="rut">RUT:</label>
                        <input class="forminput" type="text" id="rut" name="rut" placeholder="12345678-k" minlength="9"  maxlength="10"  required><br />
                    </div>
                    <br />
                    <div class="inputlbl">
                        <label class="lang lblform" key="F2" for="birthdate">FECHA DE NACIMIENTO:</label><br />
                        <input class="forminput" placeholder="DD-MM-AAAA" maxlength="10" type="date" id="birthdate" name="birthdate" required><br />
                    </div>
                    <br />
                    <div class="inputlbl">
                        <label class="lang lblform" key="F2" for="address">DIRECCIÓN:</label>
                        <input class="forminput" type="text" id="address" name="address" minlength="5" required><br />
                    </div>
                    <br />
                    <div class="inputlbl">
                        <label class="lang lblform" key="F2" for="comune">COMUNA:</label>
                        <input class="forminput" type="text" id="comune" name="comune" minlength="3" required><br />
                    </div>
                    <br />
                    <div class="inputlbl">
                        <label class="lang lblform" key="F2" for="region">REGIÓN:</label>
                        <br />
                        <select class="select" name="region" id="regionSelect"></select>
                    </div>
                    <br />
                    <div class="inputlbl">
                        <label class="lang lblform" key="F2" for="country">PAÍS:</label>
                        <input class="forminput" type="text" id="country" name="country" minlength="3" required><br />
                    </div>
                    <br />
                    <div class="inputlbl">
                        <label class="lang lblform" key="F2" for="phone">TELÉFONO:</label>
                        <input class="forminput" type="text" id="phone" name="phone" minlength="9" maxlength="12" required><br />
                    </div>
                    <br />
                    <div class="inputlbl">
                        <label class="lang lblform" key="F2" for="mail">EMAIL:</label>
                        <input class="forminput" type="text" id="mail" name="mail" required><br />
                    </div>
                    <br />
                    <div class="inputlbl">
                        <label class="lang lblform" key="F2" for="pass">CONTRASEÑA:</label>
                        <input class="forminput" type="password" id="pass" name="pass" required><br />
                    </div>
                    <br />
                    <br />
                    <div class="inputlbl">
                        <input type="checkbox" id="conforme" onclick="checkedPolicy()">
                        <label class="lblform" for="conforme">Estoy de acuerdo con las <a target="_blank" href="/policy">políticas</a> de Meipulseras.cl</label>
                    </div>
                    <br />
            <input class="cotiza pe" type="submit" value="Enviar" id="aceptarForm" disabled="true" onclick="validarRut()">
        </form>
    </div>
    <p id="data" style="display: none;"><%= registrado %></p>
    <script src="/js/date.js" type="text/javascript"></script>
    <script src="/js/region.js" type="text/javascript"></script>
    <script src="/js/moduloOnce.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>    
    <script>
        function checkedPolicy(){
            var checked = document.getElementById("conforme");
            var disabled = document.getElementById("aceptarForm");

            if(checked.checked == true) {
                disabled.disabled = false;
            } else if (checked.checked == false) {
                disabled.disabled = true;
            }

        }
    </script>
    <script>
        function alerta(){
            var alerta = document.getElementById('data').innerText;

            function swalMessage(message) {
                Swal.fire({
                    title: 'Error',
                    text: message,
                    icon: 'error',
                    confirmButtonText: 'Aceptar',
                    showConfirmButton: true,
                }).then(function() {
                    window.location = "/signup";
                    alerta = 'no';
                });
            }
        
            if(alerta === 'yes'){
                swalMessage('Usuario y/o correo electronico ya registrado.')
            } else if(alerta === 'invalidregister') {      
                swalMessage('Ha utilizado caracteres no permitidos al registrarse. Valide los datos ingresados e intente de nuevo.')
            } else if(alerta === 'yes+invalidregister') {      
                swalMessage('Usuario y/o correo electronico ya registrado. Además ha utilizado caracteres no permitidos al registrarse. Valide los datos ingresados e intente de nuevo.')
            }      
        }
    </script>
    <script>
        function validarRut() {

            document.getElementById('registro').addEventListener('submit', function(event){
                
                var rut = document.getElementById('rut').value;
                
                event.preventDefault();

                console.log(rut)

                const form = this;

                if(!Fn.validarRut(rut)) {
                    Swal.fire({
                        title: 'Error',
                        text: 'RUT inválido.',
                        icon: 'error',
                        confirmButtonText: 'Aceptar',
                        showConfirmButton: true,
                    }).then(function() {
                        window.location = "/signup";
                    });
                } else {
                    form.submit();
                }

            });  
        }
    </script>
</body>
</html>